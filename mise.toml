[tasks.seed]
run = "dotnet run --project tools/Conduit.Tools db seed"

[tasks.fresh]
run = "dotnet run --project tools/Conduit.Tools db fresh"

[tasks.dev]
run = "dotnet run --project src/Conduit.WebUI"

[tasks.watch]
run = "dotnet watch --project src/Conduit.WebUI"

[tasks.vendor]
run = [
  "dotnet tool restore",
  "dotnet restore"
]

[tasks.lint]
run = "dotnet format --verify-no-changes"

[tasks.build]
run = [
  "dotnet sonarscanner begin /k:\"aspnet-core-realworld\" /d:sonar.host.url=\"$SONAR_HOST_URL\" /d:sonar.token=\"$SONAR_TOKEN\" /d:sonar.cs.vscoveragexml.reportsPaths=coverage.xml",
  "dotnet build -c Release"
]

[tasks.test]
run = [
  "dotnet coverage collect 'dotnet test -c Release --no-restore --no-build --verbosity=normal' -f xml -o 'coverage.xml'",
  "dotnet sonarscanner end /d:sonar.token=\"$SONAR_TOKEN\"",
  "dotnet publish src/Conduit.WebUI -c Release -o publish --no-restore --no-build --verbosity=normal",
  "dotnet publish tools/Conduit.Tools -c Release -o publish --no-restore --no-build --verbosity=normal"
]

[tasks.ci]
run = [
  { task = "vendor" },
  { task = "lint" },
  { task = "build" },
  { task = "test" },
]

[tools]
dotnet = "10"
